<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>M3U Oynatıcı</title>
<link href="https://vjs.zencdn.net/8.12.0/video-js.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bgd:#121212;--bgm:#1e1e1e;--bgl:#2a2a2a;--tc:#e0e0e0;--ac:#007bff;--ah:#0056b3;--fo:#00aaff;--bc:#333;--sc:rgba(0,0,0,.5)}body{font-family:'Inter','Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--bgd);color:var(--tc);display:flex;min-height:100vh;margin:0;overflow:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.main-container{display:flex;flex-direction:column;width:100%;max-width:1400px;margin:20px auto;background-color:var(--bgm);border-radius:12px;box-shadow:0 8px 30px var(--sc);overflow:hidden}.content-area{display:flex;flex-grow:1}.category-panel{width:280px;background-color:var(--bgd);padding:20px 0;overflow-y:auto;border-right:1px solid var(--bc);flex-shrink:0}.category-panel h3{text-align:center;margin-bottom:20px;color:#fff;font-size:1.5em;letter-spacing:.5px}.category-panel input[type="text"]{width:calc(100% - 40px);margin:0 20px 20px;padding:10px 15px;border-radius:8px;border:1px solid var(--bc);background-color:#333;color:var(--tc);box-sizing:border-box;font-size:.95em;transition:all .3s ease}.category-panel input[type="text"].focused,.category-panel input[type="text"]:focus{outline:3px solid var(--fo);border-color:var(--fo);box-shadow:0 0 0 4px rgba(0,170,255,.2)}.category-panel ul{list-style:none;padding:0;margin:0}.category-panel li{padding:14px 25px;cursor:pointer;transition:background-color .3s ease,border-left-color .3s ease;border-left:5px solid transparent;font-size:1.05em;position:relative}.category-panel li:hover{background-color:#333}.category-panel li.active{background-color:var(--ac);border-left-color:var(--fo);font-weight:700;color:#fff}.category-panel li.active::after{content:'►';position:absolute;right:15px;color:#fff;font-size:.9em}.category-panel li.focused{outline:3px solid var(--fo);background-color:#444;outline-offset:-2px}.player-list-area{flex-grow:1;display:flex;flex-direction:column;background-color:var(--bgl)}.player-wrapper{width:100%;position:relative;background-color:#000;border-bottom:1px solid var(--bc)}.video-js{width:100%!important;height:auto!important;min-height:350px}.vjs-control-bar{background-color:rgba(0,0,0,.8);border-radius:0 0 12px 12px}.vjs-button>.vjs-icon-placeholder:before{font-size:1.8em;color:var(--tc)}.vjs-menu-button-popup .vjs-menu{background-color:rgba(42,42,42,.95);border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,.4)}.vjs-menu-item{color:var(--tc);padding:8px 15px;transition:background-color .2s ease}.vjs-menu-item:focus,.vjs-menu-item:hover{background-color:#3a3a3a;color:#fff}.vjs-current-time,.vjs-duration{color:var(--tc)}.video-js.vjs-waiting .vjs-loading-spinner{border-color:var(--tc);border-top-color:var(--ac)}.channel-list-wrapper{padding:20px;overflow-y:auto;flex-grow:1;outline:none;min-height:0;background-color:var(--bgl)}.channel-list-wrapper input[type=text]{width:calc(100% - 40px);padding:10px 15px;margin-bottom:20px;border-radius:8px;border:1px solid var(--bc);background-color:#333;color:var(--tc);box-sizing:border-box;font-size:.95em;transition:all .3s ease}.channel-list-wrapper input[type=text].focused,.channel-list-wrapper input[type=text]:focus{outline:3px solid var(--fo);border-color:var(--fo);box-shadow:0 0 0 4px rgba(0,170,255,.2)}.channel-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}.channel-item{background-color:#333;border-radius:10px;overflow:hidden;cursor:pointer;transition:transform .2s ease,box-shadow .2s ease,outline-color .2s ease,background-color .2s ease;text-align:center;padding:15px;outline:2px solid transparent;position:relative}.channel-item:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,0,0,.4);background-color:#3a3a3a}.channel-item img{max-width:90px;height:auto;margin-bottom:12px;border-radius:8px;object-fit:contain}.channel-item .channel-name{font-weight:600;color:var(--tc);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:1.1em;padding:0 5px}.channel-item.focused{outline:3px solid var(--fo);background-color:#444;box-shadow:0 8px 20px rgba(0,0,0,.4)}.resume-prompt{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:100;font-size:1.4em;text-align:center;color:#fff;padding:20px;box-sizing:border-box}.resume-prompt p{margin-bottom:25px;line-height:1.5;font-weight:500}.resume-prompt button{background-color:var(--ac);color:#fff;border:none;padding:12px 25px;border-radius:8px;cursor:pointer;margin:0 10px;font-size:1.1em;transition:background-color .3s ease,outline .2s ease,transform .2s ease}.resume-prompt button:hover{background-color:var(--ah);transform:translateY(-2px)}.resume-prompt button.focused{outline:3px solid var(--fo);background-color:var(--ah);outline-offset:3px}.loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.95);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;color:#fff;font-size:1.8em;opacity:1;visibility:visible;transition:opacity .4s ease,visibility .4s ease}.loading-screen.hidden{opacity:0;visibility:hidden;pointer-events:none}.loading-spinner{border:6px solid rgba(255,255,255,.3);border-top:6px solid var(--ac);border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;margin-bottom:25px}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.error-message{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background-color:#dc3545;color:#fff;padding:12px 25px;border-radius:8px;z-index:1000;opacity:0;visibility:hidden;transition:opacity .4s ease,visibility .4s ease;box-shadow:0 4px 15px rgba(0,0,0,.3)}.error-message.show{opacity:1;visibility:visible}

/* YENİ KONTROL PANELİ STİLLERİ */
.control-panel {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(30, 30, 30, 0.9);
    border-radius: 20px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    z-index: 999;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    opacity: 0.9;
}

.control-panel:hover {
    opacity: 1;
}

.control-row {
    display: flex;
    justify-content: center;
    gap: 10px;
}

.control-btn {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    background: var(--bgm);
    border: 2px solid var(--bc);
    color: var(--tc);
    font-size: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    user-select: none;
}

.control-btn:active {
    transform: scale(0.95);
    background: var(--ac);
}

.control-btn:hover {
    border-color: var(--fo);
    box-shadow: 0 0 15px var(--fo);
}

.control-btn::after {
    content: attr(data-key);
    position: absolute;
    bottom: -25px;
    font-size: 12px;
    color: var(--tc);
    opacity: 0.7;
}

.center-btn {
    width: 80px;
    height: 80px;
    font-size: 30px;
}

.volume-control {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(30, 30, 30, 0.9);
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
    display: none;
}

.control-btn.active {
    background: var(--ac);
    color: white;
    transform: scale(0.95);
}

.gamepad-notification {
    position: fixed;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--ac);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.gamepad-notification.show {
    opacity: 1;
}

@media (max-width:1024px){.main-container{max-width:95%;margin:15px auto}.category-panel{width:220px;padding:15px 0}.video-js{min-height:280px}.channel-list{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px}.channel-item img{max-width:70px}}@media (max-width:768px){body{overflow-y:auto}.main-container{flex-direction:column;margin:10px auto;height:auto;min-height:unset;border-radius:0}.content-area{flex-direction:column;min-height:unset}.category-panel{width:100%;border-right:none;border-bottom:1px solid var(--bc);padding:10px;max-height:180px}.category-panel h3{display:none}.category-panel input[type="text"]{width:calc(100% - 20px);margin:0 10px 10px}.category-panel ul{display:flex;overflow-x:auto;white-space:nowrap;padding-bottom:10px;-webkit-overflow-scrolling:touch}.category-panel li{flex:0 0 auto;margin:0 5px;padding:8px 15px;border-left:none;border-bottom:3px solid transparent;border-radius:6px}.category-panel li.active{border-left:none;border-bottom-color:var(--fo)}.category-panel li.active::after{display:none}.player-wrapper{order:-1;margin-bottom:15px;border-radius:0}.video-js{min-height:220px}.channel-list-wrapper{padding:15px;height:auto;min-height:unset}.channel-list{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}.channel-item{padding:10px;border-radius:8px}.channel-item img{max-width:60px}.resume-prompt{font-size:1.1em;padding:15px}.resume-prompt button{padding:10px 20px;font-size:1em;margin:0 8px}.loading-screen{font-size:1.3em}.loading-spinner{width:45px;height:45px;border-width:5px}

/* Mobil için kontrol paneli ayarları */
.control-panel {
    bottom: 10px;
    padding: 10px;
}

.control-btn {
    width: 50px;
    height: 50px;
    font-size: 20px;
}

.center-btn {
    width: 60px;
    height: 60px;
    font-size: 24px;
}
}</style>
</head>
<body>
<div class="main-container"><div class="content-area" id="contentArea"><div class="category-panel"><h3>Filmler</h3><input type="text" id="categorySearchInput" placeholder="Kategori içinde ara..."><ul id="categoryList"></ul></div><div class="player-list-area"><div class="player-wrapper"><video id="my-video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" data-setup='{}'></video><div id="resumePrompt" class="resume-prompt" style="display:none;"><p>Kaldığınız yerden devam etmek ister misiniz?</p><div><button id="resumeYes">Evet</button><button id="resumeNo">Baştan Başlat</button></div></div></div><div class="channel-list-wrapper" id="channelListWrapper" tabIndex="0"><input type="text" id="channelSearchInput" placeholder="Film içinde ara..."><div id="channelList" class="channel-list"></div></div></div></div><div class="loading-screen" id="loadingScreen"><div class="loading-spinner"></div><p>İçerik yükleniyor, lütfen bekleyin...</p></div><div id="errorMessage" class="error-message"></div>

<!-- YENİ KONTROL PANELİ -->
<div class="control-panel" id="controlPanel">
    <div class="gamepad-notification" id="gamepadNotification"></div>
    <div class="control-row">
        <div class="control-btn" id="btnVolume" data-key="Ses">🔈</div>
    </div>
    <div class="control-row">
        <div class="control-btn" id="btnBack" data-key="Geri (Esc)">←</div>
        <div class="control-btn center-btn" id="btnPlayPause" data-key="Oynat/Duraklat (⏎)">⏯</div>
        <div class="control-btn" id="btnFullscreen" data-key="Tam Ekran (F)">⛶</div>
    </div>
    <div class="control-row">
        <div class="control-btn" id="btnRewind" data-key="Geri Sar (←)">⏪</div>
        <div class="control-btn" id="btnForward" data-key="İleri Sar (→)">⏩</div>
    </div>
    <div class="volume-control" id="volumeControl">
        <div class="control-btn" id="btnVolUp" data-key="Artır (↑)">🔊</div>
        <div class="control-btn" id="btnVolDown" data-key="Azalt (↓)">🔉</div>
    </div>
</div>

<script src="https://vjs.zencdn.net/8.12.0/video.min.js"></script>
<script src="https://unpkg.com/@videojs/http-streaming/dist/videojs-http-streaming.min.js"></script>
<script>
// Mevcut kodlarınız aynen kalacak...
const d=(f,l)=>{let t;return function(...a){const c=this;clearTimeout(t);t=setTimeout(()=>f.apply(c,a),l)}};
const s=(m,y='error')=>{const e=document.getElementById('errorMessage');e.textContent=m;e.className=`error-message show ${y}`;setTimeout(()=>e.classList.remove('show'),5e3)};
const p=m=>{const l=m.split('\n'),c=[];let C={};for(const L of l){if(L.startsWith('#EXTINF:')){const[t,T,g,G,N]=[L.match(/tvg-id="([^"]*)"/),L.match(/tvg-name="([^"]*)"/),L.match(/tvg-logo="([^"]*)"/),L.match(/group-title="([^"]*)"/),L.match(/,(.*)$/)];let n=(T&&T[1])?T[1].trim():(N&&N[1])?N[1].trim():'Bilinmeyen Kanal';C={id:t?t[1]:'',name:n,logo:g?g[1]:'',category:G?G[1].trim():'Diğer',url:''}}else if(L.startsWith('http')||L.startsWith('rtmp')){if(C.name){C.url=L.trim();c.push(C);C={}}}}return c};
const cl=document.getElementById('categoryList'),chl=document.getElementById('channelList'),chs=document.getElementById('channelSearchInput'),rp=document.getElementById('resumePrompt'),ryb=document.getElementById('resumeYes'),rnb=document.getElementById('resumeNo'),ls=document.getElementById('loadingScreen'),cs=document.getElementById('categorySearchInput');
const ml='https://raw.githubusercontent.com/ademolalookman/ademola/refs/heads/main/filmfun.m3u';let ac=[],pl,cp=null,fc=[],fgc=[];let cf={group:'category',index:0};

// YENİ KONTROL FONKSİYONLARI
function setupControls() {
    const btnPlayPause = document.getElementById('btnPlayPause');
    const btnFullscreen = document.getElementById('btnFullscreen');
    const btnBack = document.getElementById('btnBack');
    const btnRewind = document.getElementById('btnRewind');
    const btnForward = document.getElementById('btnForward');
    const btnVolume = document.getElementById('btnVolume');
    const btnVolUp = document.getElementById('btnVolUp');
    const btnVolDown = document.getElementById('btnVolDown');
    const volumeControl = document.getElementById('volumeControl');
    
    // Oynat/Duraklat butonu
    btnPlayPause.addEventListener('click', () => {
        if (pl) {
            if (pl.paused()) {
                pl.play();
                btnPlayPause.textContent = '⏸';
            } else {
                pl.pause();
                btnPlayPause.textContent = '▶';
            }
            btnPlayPause.classList.add('active');
            setTimeout(() => btnPlayPause.classList.remove('active'), 200);
        }
    });
    
    // Tam ekran butonu
    btnFullscreen.addEventListener('click', () => {
        if (pl) {
            if (pl.isFullscreen()) {
                pl.exitFullscreen();
            } else {
                pl.requestFullscreen();
            }
            btnFullscreen.classList.add('active');
            setTimeout(() => btnFullscreen.classList.remove('active'), 200);
        }
    });
    
    // Geri butonu
    btnBack.addEventListener('click', () => {
        if (cf.group === 'player' || cf.group === 'channel') {
            cf.group = 'category';
            cf.index = (fgc.indexOf(cl.querySelector('li.active').textContent) ?? 0;
            uF();
            btnBack.classList.add('active');
            setTimeout(() => btnBack.classList.remove('active'), 200);
        }
    });
    
    // Geri sar butonu
    btnRewind.addEventListener('click', () => {
        if (pl) {
            pl.currentTime(Math.max(0, pl.currentTime() - 10));
            btnRewind.classList.add('active');
            setTimeout(() => btnRewind.classList.remove('active'), 200);
        }
    });
    
    // İleri sar butonu
    btnForward.addEventListener('click', () => {
        if (pl) {
            pl.currentTime(Math.min(pl.duration(), pl.currentTime() + 10));
            btnForward.classList.add('active');
            setTimeout(() => btnForward.classList.remove('active'), 200);
        }
    });
    
    // Ses kontrolü
    btnVolume.addEventListener('click', () => {
        volumeControl.style.display = volumeControl.style.display === 'block' ? 'none' : 'block';
    });
    
    btnVolUp.addEventListener('click', () => {
        if (pl) {
            pl.volume(Math.min(1, pl.volume() + 0.1));
            btnVolUp.classList.add('active');
            setTimeout(() => btnVolUp.classList.remove('active'), 200);
        }
    });
    
    btnVolDown.addEventListener('click', () => {
        if (pl) {
            pl.volume(Math.max(0, pl.volume() - 0.1));
            btnVolDown.classList.add('active');
            setTimeout(() => btnVolDown.classList.remove('active'), 200);
        }
    });
    
    // Oyun kumandası desteği
    let gamepadConnected = false;
    
    function gamepadHandler(event, connecting) {
        const gamepad = event.gamepad;
        const notification = document.getElementById('gamepadNotification');
        
        if (connecting) {
            gamepadConnected = true;
            notification.textContent = `Oyun kumandası bağlandı: ${gamepad.id}`;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        } else {
            gamepadConnected = false;
            notification.textContent = 'Oyun kumandası bağlantısı kesildi';
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }
    }
    
    window.addEventListener("gamepadconnected", (e) => gamepadHandler(e, true));
    window.addEventListener("gamepaddisconnected", (e) => gamepadHandler(e, false));
    
    function updateGamepad() {
        if (!gamepadConnected) return;
        
        const gamepads = navigator.getGamepads();
        if (!gamepads) return;
        
        const gp = gamepads[0];
        if (!gp) return;
        
        // Buton kontrolleri
        if (gp.buttons[0].pressed) { // A butonu (Oynat/Duraklat)
            if (pl) pl.paused() ? pl.play() : pl.pause();
        }
        if (gp.buttons[1].pressed) { // B butonu (Geri)
            if (cf.group === 'player' || cf.group === 'channel') {
                cf.group = 'category';
                cf.index = (fgc.indexOf(cl.querySelector('li.active').textContent) ?? 0);
                uF();
            }
        }
        if (gp.buttons[6].pressed) { // LB butonu (Geri sar)
            if (pl) pl.currentTime(Math.max(0, pl.currentTime() - 10));
        }
        if (gp.buttons[7].pressed) { // RB butonu (İleri sar)
            if (pl) pl.currentTime(Math.min(pl.duration(), pl.currentTime() + 10));
        }
        
        // D-pad kontrolleri
        if (gp.axes[1] < -0.5) { // Yukarı (Ses artır)
            if (pl) pl.volume(Math.min(1, pl.volume() + 0.05));
        }
        if (gp.axes[1] > 0.5) { // Aşağı (Ses azalt)
            if (pl) pl.volume(Math.max(0, pl.volume() - 0.05));
        }
        
        requestAnimationFrame(updateGamepad);
    }
    
    // Oyun kumandası kontrol döngüsünü başlat
    if (navigator.getGamepads) {
        setInterval(() => {
            if (gamepadConnected) {
                updateGamepad();
            }
        }, 100);
    }
}

document.addEventListener('DOMContentLoaded',()=>{
    pl=videojs('my-video',{fluid:true,autoplay:false,controls:true,techCanOverrideControls:true,controlBar:{children:['playToggle','volumePanel','currentTimeDisplay','durationDisplay','progressControl','liveDisplay','customControlSpacer','playbackRateMenuButton','chaptersButton','descriptionsButton','subsCapsButton','audioTrackButton','fullscreenToggle']});
    loadM3ULink(ml);
    setupControls(); // Kontrolleri kur
});

// Mevcut fonksiyonlarınız aynen kalacak...
async function loadM3ULink(l){ls.classList.remove('hidden');try{const r=await fetch(l);if(!r.ok)throw new Error(`HTTP Hatası! Durum: ${r.status}`);const m=await r.text();ac=p(m);rC();fCh(cl.querySelector('li.active')?.textContent||'Tümü')}catch(e){console.error('M3U Link Hatası:',e);s('İçerik yüklenirken bir hata oluştu: '+e.message,'error')}finally{ls.classList.add('hidden');uF()}}function rC(t=''){let c=['Tümü',...new Set(ac.map(ch=>ch.category))];if(t)c=c.filter(cat=>cat.toLowerCase().includes(t.toLowerCase()));c.sort((a,b)=>{if(a==='Tümü')return-1;if(b==='Tümü')return 1;return a.localeCompare(b)});fgc=c;const f=document.createDocumentFragment();c.forEach((cat,idx)=>{const l=document.createElement('li');l.textContent=cat;l.dataset.index=idx;l.onclick=()=>{sAC(l);fCh(cat);cf={group:'channel',index:0};uF()};f.appendChild(l)});cl.innerHTML='';cl.appendChild(f);if(c.length>0){const a=cl.querySelector('li.active');if(!a||!c.includes(a.textContent)){sAC(cl.querySelector('li'))}}}function sAC(l){document.querySelectorAll('#categoryList li').forEach(i=>i.classList.remove('active'));if(l)l.classList.add('active')}cs.addEventListener('input',d(()=>{rC(cs.value.trim())},300));chs.addEventListener('input',d(()=>{const a=cl.querySelector('li.active');const c=a?a.textContent:'Tümü';fCh(c,chs.value.trim())},300));function fCh(c,t=''){const f=document.createDocumentFragment();fc=ac.filter(ch=>(c==='Tümü'||ch.category===c)&&(ch.name.toLowerCase().includes(t.toLowerCase())));if(fc.length===0){chl.innerHTML='<p style="text-align:center;color:#ccc;padding:20px;">Bu kategoride film bulunamadı.</p>';return}fc.forEach((ch,idx)=>{const d=document.createElement('div');d.className='channel-item';d.dataset.index=idx;d.innerHTML=`${ch.logo?`<img src="${ch.logo}" alt="${ch.name} Logo" loading="lazy">`:''}<div class="channel-name" title="${ch.name}">${ch.name}</div>`;d.onclick=()=>pCh(ch);f.appendChild(d)});chl.innerHTML='';chl.appendChild(f)}function pCh(ch){if(!ch||!ch.url){s('Geçersiz kanal bilgisi veya URL.','error');return}cp=ch;ls.classList.remove('hidden');pl.off('loadedmetadata');pl.off('error');pl.off('timeupdate');pl.off('ended');pl.src({src:ch.url,type:'application/x-mpegURL'});pl.poster(ch.logo||'');pl.load();pl.on('loadedmetadata',function(){ls.classList.add('hidden');const k='m3u_player_last_position_'+btoa(ch.url);const lp=parseFloat(localStorage.getItem(k));if(pl.duration()===Infinity||isNaN(pl.duration())){pl.play();rp.style.display='none';cf.group='player';uF()}else if(lp&&lp>5&&(pl.duration()-lp)>10){rp.style.display='flex';cf.group='resumePrompt';cf.index=0;uF();ryb.onclick=()=>{pl.currentTime(lp);rp.style.display='none';pl.play();cf.group='player';uF()};rnb.onclick=()=>{pl.currentTime(0);rp.style.display='none';pl.play();cf.group='player';uF()}}else{pl.currentTime(0);rp.style.display='none';pl.play();cf.group='player';uF()}});pl.on('error',function(){ls.classList.add('hidden');const e=pl.error();let m='Video yüklenirken bilinmeyen bir hata oluştu.';if(e){m=`Video Hatası (${e.code}): ${e.message}. Lütfen farklı bir film deneyin.`;console.error('Video oynatma hatası:',e.code,e.message,e.data)}s(m,'error');cf.group='channel';uF()});pl.on('timeupdate',function(){if(cp&&!pl.seeking()&&!pl.paused()&&pl.duration()!==Infinity&&!isNaN(pl.duration())){const k='m3u_player_last_position_'+btoa(cp.url);localStorage.setItem(k,pl.currentTime().toString())}});pl.on('ended',function(){if(cp){const k='m3u_player_last_position_'+btoa(cp.url);localStorage.removeItem(k)}});pl.focus()}
function uF(){document.querySelectorAll('.focused').forEach(function(e){e.classList.remove('focused')});if(rp.style.display==='flex'){var t=[ryb,rnb],n=t[cf.index];n&&(n.classList.add('focused'),n.focus());return}document.activeElement!==cs&&cs.blur(),document.activeElement!==chs&&chs.blur();var e=null;cf.group==='category'?e=cl.children[cf.index]:cf.group==='channel'&&(e=chl.children[cf.index]),e?(e.classList.add('focused'),e.scrollIntoView({block:'nearest',behavior:'smooth'})):cf.group==='player'&&pl.focus()}
document.addEventListener('keydown',function(e){var t=document.activeElement,n=!pl.paused()||pl.userActive()||pl.isFullscreen(),c=rp.style.display==='flex',l=t===cs||t===chs;if(l){e.key==='Escape'&&(e.preventDefault(),t.blur());return}if(c){e.preventDefault(),e.key==='ArrowLeft'?cf.index=0:e.key==='ArrowRight'?cf.index=1:e.key==='Enter'?[ryb,rnb][cf.index]?.click():e.key==='Escape'&&rnb.click(),uF();return}if(n){var o=[' ','Enter','MediaPlayPause','ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Escape'];if(o.includes(e.key)){e.preventDefault();switch(e.key){case' ':case'Enter':case'MediaPlayPause':pl.paused()?pl.play():pl.pause();break;case'ArrowLeft':pl.currentTime(pl.currentTime()-10);break;case'ArrowRight':pl.currentTime(pl.currentTime()+10);break;case'ArrowUp':pl.volume(Math.min(1,pl.volume()+.1));break;case'ArrowDown':pl.volume(Math.max(0,pl.volume()-.1));break;case'Escape':pl.isFullscreen()?pl.exitFullscreen():(pl.pause(),cf.group='channel',uF())}}return}e.preventDefault();var r=function(){return getComputedStyle(chl).gridTemplateColumns.split(' ').length};switch(e.key){case'ArrowUp':cf.group==='category'?cf.index=Math.max(0,cf.index-1):cf.group==='channel'&&(cf.index=Math.max(0,cf.index-r())),uF();break;case'ArrowDown':cf.group==='category'?cf.index=Math.min(fgc.length-1,cf.index+1):cf.group==='channel'&&(cf.index=Math.min(fc.length-1,cf.index+r())),uF();break;case'ArrowLeft':cf.group==='channel'&&(cf.index%r()==0?(cf.group='category',cf.index=(fgc.indexOf(cl.querySelector('li.active').textContent)??-1)!==-1?fgc.indexOf(cl.querySelector('li.active').textContent):0):cf.index-=1),uF();break;case'ArrowRight':cf.group==='category'?(cf.group='channel',cf.index=0):cf.group==='channel'&&cf.index<fc.length-1&&(cf.index+=1),uF();break;case'Enter':var i;cf.group==='category'?i=cl.children[cf.index]:i=chl.children[cf.index],i?.click();break;case'Escape':cf.group==='channel'&&(cf.group='category',cf.index=(fgc.indexOf(cl.querySelector('li.active').textContent)??-1)!==-1?fgc.indexOf(cl.querySelector('li.active').textContent):0,uF())}});
</script>
</body>
</html>